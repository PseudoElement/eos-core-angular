<div class="tree-user-select-wrapper">
    <!-- табы выбора мода -->
    <div class="select-modes">
        <ul class="tabs">
            <li class="tab-item"
                *ngFor="let tab of modes"
                role="presentation"
                [ngClass]="{'active secondary-text': tab.key === currMode}"
                (click)="setTab(tab.key)"
                >
                <span 
                containerClass="tooltip-info"
                tooltip="{{tab.tooltip}}"
                placement="bottom"
                class="tab-title">{{tab.title}}</span>
            </li>
        </ul>
    </div>
    <div *ngIf="!isLoading; else spiner" class="tree-wrapper-overflow">
        <ng-container [ngSwitch]="GetTypeUsers()">
            <ng-container *ngSwitchCase="'users'">
                <ng-container *ngTemplateOutlet="treeTmpl; context: {items: nodes, level: 0}"></ng-container>
            </ng-container>
            <ng-container *ngSwitchCase="'del'">
                <div class="eos-tree-node" *ngIf="nodes[0].title === 'Все подразделения'">
                    <div [ngClass]="{'highlighted' : true, 'node': true, 'activeTree': true}"
                        [ngStyle]="{'padding-left.px': getPadding(1)}">
                        <div class="title"
                            [ngClass]="{'deleted': false, 'select': false}"
                            [style.width.px]="getNodeWidth(0)">
                            <span class="title-item">{{nodes[0].title}}</span>
                        </div>
                    </div>
                </div>
            </ng-container>
            <ng-container *ngSwitchCase="'tech'">
                <div *ngIf="nodes[0].title === 'Все подразделения'; else centCard">
                    <div class="eos-tree-node">
                        <div [ngClass]="{'highlighted' : true, 'node': true, 'activeTree': true}"
                        [ngStyle]="{'padding-left.px': getPadding(1)}">
                            <div class="title"
                                [ngClass]="{'deleted': false, 'select': false}"
                                [style.width.px]="getNodeWidth(0)">
                                <span class="title-item">{{nodes[0].title}}</span>
                            </div>
                        </div>
                    </div>
                </div>  
                <ng-template #centCard>
                    <ng-container *ngTemplateOutlet="treeTmpl; context: {items: nodes, level: 0}"></ng-container>
                </ng-template>    
            </ng-container>
        </ng-container>
       
    </div>
</div>

<ng-template #treeTmpl
    let-items="items"
    let-level="level">
    <div *ngFor="let node of items"
        class="eos-tree-node">
        <ng-container *ngTemplateOutlet="treeNodeTmpl; context:{node: node, level:level}"></ng-container>
    </div>
</ng-template>

<ng-template #treeNodeTmpl
    let-node="node"
    let-level="level">
    <!-- <div style="width: 400px; height: 50px;"></div> -->
    <ng-container *ngIf="node && (!node.isDeleted || showDeleted)">
        <div
            #el
            (click)="onSelect($event, node)"
            [ngClass]="{'highlighted' : node.isActive, 'node': true, 'activeTree': node.id === id}"
            [ngStyle]="{'padding-left.px': getPadding(level)}">
            <!-- span class="fake-padding"></span -->
            <div class="tree-btn"
                (click)="onExpand($event, node)">
                <span *ngIf="node.expandable"
                    class="eos-icon tringle-size icon"
                    [ngClass]="{'eos-icon-open-folder-blue': node.isExpanded, 'eos-icon-close-folder-blue': !node.isExpanded}"></span>
            </div>
            <div class="title"
                [ngClass]="{'deleted': node.isDeleted, 'select': node.isActive}"
                [style.width.px]="getNodeWidth(level)">
                <span class="title-item">{{node.title}}</span>
                <eos-spinner *ngIf="node.updating"
                    size="sm"></eos-spinner>
            </div>
        </div>
        <ng-container *ngIf="node.isExpanded && node.expandable">
            <ng-container *ngTemplateOutlet="treeTmpl; context: {items: node.children, level: level*1+1}"></ng-container>
        </ng-container>
    </ng-container>
</ng-template>

<ng-template #spiner>
    <eos-spinner size="lg"></eos-spinner>
</ng-template>